<div class="page-container">

  <!-- HEADER -->
  <header class="page-header">
    <h2>üìã Prontu√°rio</h2>
    <p>Busque o prontu√°rio completo do paciente pelo CPF</p>
  </header>

  <!-- BUSCA -->
  <section class="card busca">
    <input type="text" placeholder="Digite o CPF" [(ngModel)]="cpfBusca" />
    <button (click)="buscarProntuario()" [disabled]="carregando">
      {{ carregando ? 'Buscando...' : 'Buscar' }}
    </button>
  </section>

  <!-- ERRO -->
  <section class="alert error" *ngIf="erro">
    {{ erro }}
  </section>

  <!-- CONTE√öDO -->
  <section *ngIf="prontuario" class="content">

    <!-- PACIENTE -->
    <div class="card info">
      <h3>üßë‚Äç‚öïÔ∏è {{ prontuario.paciente?.nome }}</h3>
      <span>
        Nascimento:
        {{ prontuario.paciente?.dataNascimento | date:'dd/MM/yyyy':'UTC' }}
      </span>
    </div>

    <!-- PROFISSIONAL -->
    <div class="card info">
      <h4>üë®‚Äç‚öïÔ∏è Profissional</h4>
      <span>
        {{ prontuario.profissional?.nome }}
        ({{ prontuario.profissional?.crefito }})
      </span>
    </div>

    <!-- AVALIA√á√ÉO -->
    <div class="card avaliacao" *ngIf="prontuario.avaliacao">
  <h4>üìù Avalia√ß√£o</h4>

  <div class="grid">
    <div><strong>Data</strong><span>{{ prontuario.avaliacao.data | date:'dd/MM/yyyy':'UTC' }}</span></div>
    <div><strong>Tipo</strong><span>{{ prontuario.avaliacao.tipo }}</span></div>
    <div><strong>Queixa</strong><span>{{ prontuario.avaliacao.queixa }}</span></div>
    <div><strong>Dor</strong><span>{{ prontuario.avaliacao.dor }}</span></div>
    <div><strong>Diagn√≥stico</strong><span>{{ prontuario.avaliacao.diagnostico }}</span></div>
    <div><strong>Plano</strong><span>{{ prontuario.avaliacao.plano }}</span></div>
    <div class="full"><strong>Observa√ß√£o</strong><span>{{ prontuario.avaliacao.observacao }}</span></div>
  </div>
</div>

    <!-- EVOLU√á√ïES -->
    <div class="card">
      <h4>üìà Evolu√ß√µes</h4>

      <!-- DESKTOP -->
      <table class="table" *ngIf="prontuario.evolucoes?.length">
        <thead>
          <tr>
            <th>Data</th>
            <th>Conduta</th>
            <th>Alta</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of prontuario.evolucoes" (click)="abrirHistorico(e)" class="clickable">
            <td>{{ e.data | date:'dd/MM/yyyy':'UTC' }}</td>
            <td>{{ e.conduta }}</td>
            <td>
              <span class="badge" [class.ok]="e.alta">
                {{ e.alta ? 'Sim' : 'N√£o' }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- MOBILE -->
      <div class="mobile-list">
        <div class="mobile-card" *ngFor="let e of prontuario.evolucoes" (click)="abrirHistorico(e)">
          <div>
            <strong>{{ e.data | date:'dd/MM/yyyy' }}</strong>
            <span>{{ e.conduta }}</span>
          </div>
          <span class="badge" [class.ok]="e.alta">
            {{ e.alta ? 'Alta' : 'Em tratamento' }}
          </span>
        </div>
      </div>

      <p *ngIf="!prontuario.evolucoes?.length" class="empty">
        Nenhuma evolu√ß√£o registrada.
      </p>
    </div>
  </section>

  <!-- DRAWER -->
  <div class="drawer-backdrop" *ngIf="evolucaoSelecionada" (click)="fecharHistorico()"></div>

  <aside class="drawer" *ngIf="evolucaoSelecionada">
    <header>
      <h3>üìÑ Hist√≥rico</h3>
      <button (click)="fecharHistorico()">‚úñ</button>
    </header>

    <div class="drawer-content">
      <p><strong>Data:</strong> {{ evolucaoSelecionada.data | date:'dd/MM/yyyy':'UTC' }}</p>
      <p><strong>Conduta:</strong> {{ evolucaoSelecionada.conduta }}</p>
      <p><strong>Exerc√≠cios:</strong> {{ evolucaoSelecionada.exercicios }}</p>
      <p><strong>Recursos:</strong> {{ evolucaoSelecionada.recursos }}</p>
      <p><strong>Resposta:</strong> {{ evolucaoSelecionada.respostaPaciente }}</p>
      <p><strong>Observa√ß√µes:</strong> {{ evolucaoSelecionada.observacoes }}</p>
    </div>
  </aside>

</div>