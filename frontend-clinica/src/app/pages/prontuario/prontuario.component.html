<div class="page-container">

  <!-- HEADER (TELA) -->
  <header class="page-header no-print">
    <h2>üìã Prontu√°rio</h2>
    <p>Busque o prontu√°rio completo do paciente pelo CPF</p>
  </header>

  <!-- BUSCA -->
  <section class="card busca no-print">
    <input type="text" placeholder="Digite o CPF" [(ngModel)]="cpfBusca" />
    <button (click)="buscarProntuario()" [disabled]="carregando">
      {{ carregando ? 'Buscando...' : 'Buscar' }}
    </button>
  </section>

  <!-- ERRO -->
  <section class="alert error no-print" *ngIf="erro">
    {{ erro }}
  </section>

  <!-- CONTE√öDO -->
  <section *ngIf="prontuario" class="content">

    <!-- A√á√ïES -->
    <div class="card actions no-print">
      <button class="btn btn-secondary" (click)="gerarRelatorio()">
        üñ®Ô∏è Gerar relat√≥rio
      </button>
    </div>

    <!-- =========================
         RELAT√ìRIO (IMPRIME)
         ========================= -->
    <div class="relatorio-print">

      <header class="relatorio-header">
        <h1>Cl√≠nica de Fisioterapia</h1>
        <h2>Relat√≥rio de Prontu√°rio</h2>
        <p>Emitido em {{ hoje | date:'dd/MM/yyyy HH:mm' }}</p>
      </header>

      <section class="relatorio-bloco">
        <h3>Paciente</h3>
        <p><strong>Nome:</strong> {{ prontuario.paciente?.nome }}</p>
        <p>
          <strong>Nascimento:</strong>
          {{ prontuario.paciente?.dataNascimento | date:'dd/MM/yyyy':'UTC' }}
        </p>
      </section>

      <section class="relatorio-bloco">
        <h3>Profissional</h3>
        <p>
          {{ prontuario.profissional?.nome }}
          ({{ prontuario.profissional?.crefito }})
        </p>
      </section>

<section class="rel-section" *ngIf="prontuario.avaliacao">
  <h3>Avalia√ß√£o</h3>

  <table>
    <tr><td>Data</td><td>{{ prontuario.avaliacao.data | date:'dd/MM/yyyy':'UTC' }}</td></tr>
    <tr><td>Tipo</td><td>{{ prontuario.avaliacao.tipo }}</td></tr>

    <tr><td>Queixa Principal</td><td>{{ prontuario.avaliacao.queixa }}</td></tr>
    <tr><td>Hist√≥ria da Doen√ßa Atual</td><td>{{ prontuario.avaliacao.historia }}</td></tr>

    <tr><td>Doen√ßas Associadas</td><td>{{ prontuario.avaliacao.doencas }}</td></tr>
    <tr><td>Medicamentos em Uso</td><td>{{ prontuario.avaliacao.medicamentos }}</td></tr>
    <tr><td>Cirurgias Pr√©vias</td><td>{{ prontuario.avaliacao.cirurgias }}</td></tr>

    <tr><td>Dor (Escala)</td><td>{{ prontuario.avaliacao.dor }}</td></tr>

    <tr><td>Inspe√ß√£o</td><td>{{ prontuario.avaliacao.inspecao }}</td></tr>
    <tr><td>Palpa√ß√£o</td><td>{{ prontuario.avaliacao.palpacao }}</td></tr>
    <tr><td>ADM</td><td>{{ prontuario.avaliacao.adm }}</td></tr>
    <tr><td>For√ßa Muscular</td><td>{{ prontuario.avaliacao.forca }}</td></tr>
    <tr><td>Testes Especiais</td><td>{{ prontuario.avaliacao.teste }}</td></tr>

    <tr><td>Diagn√≥stico Funcional</td><td>{{ prontuario.avaliacao.diagnostico }}</td></tr>
    <tr><td>Objetivos</td><td>{{ prontuario.avaliacao.objetivos }}</td></tr>
    <tr><td>Plano Terap√™utico</td><td>{{ prontuario.avaliacao.plano }}</td></tr>

    <tr><td>Observa√ß√µes</td><td>{{ prontuario.avaliacao.observacao }}</td></tr>
  </table>
</section>

 <section class="rel-section">
  <h3>Evolu√ß√µes</h3>

  <div *ngFor="let e of prontuario.evolucoes; let i = index" class="evolucao-bloco">

    <div class="evolucao-header">
      <span><strong>Evolu√ß√£o {{ i + 1 }}</strong></span>
      <span><strong>Data:</strong> {{ e.data | date:'dd/MM/yyyy':'UTC' }}</span>
      <span><strong>Alta:</strong> {{ e.alta ? 'Sim' : 'N√£o' }}</span>
    </div>

    <div class="evolucao-body">
      <p><strong>Conduta:</strong> {{ e.conduta }}</p>

      <p *ngIf="e.exercicios">
        <strong>Exerc√≠cios:</strong> {{ e.exercicios }}
      </p>

      <p *ngIf="e.recursos">
        <strong>Recursos:</strong> {{ e.recursos }}
      </p>

      <p *ngIf="e.respostaPaciente">
        <strong>Resposta do Paciente:</strong> {{ e.respostaPaciente }}
      </p>

      <p *ngIf="e.observacoes">
        <strong>Observa√ß√µes:</strong> {{ e.observacoes }}
      </p>
    </div>

  </div>
</section>
